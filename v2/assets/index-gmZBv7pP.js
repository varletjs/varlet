import{c as O}from"./elements-b2tD0H-w.js";import{ay as S,a1 as R,j as W,aA as T,aB as k,an as i,_ as D,E as G,e as P,m as V,q as A,w as y,S as n,Q as o,p as r,N as M,P as z,O as v}from"./index-vwO9GBzB.js";import{c as Y}from"./shared-0s1dBi3F.js";import{A as L}from"./appType-fkxN3UmL.js";const Z="background-image",Q="lazy-loading",$="lazy-error",E="lazy-attempt",q=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],p="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",l=[],d=[],w=Y(100),e={loading:p,error:p,attempt:3,throttleWait:300,events:q};let h=k(u,e.throttleWait);function m(t,a){t._lazy.arg===Z?t.style.backgroundImage=`url(${a})`:t.setAttribute("src",a)}function F(t){t._lazy.loading&&m(t,t._lazy.loading),u()}function H(t){t._lazy.error&&m(t,t._lazy.error),t._lazy.state="error",f(t),u()}function I(t,a){m(t,a),t._lazy.state="success",f(t),u()}function K(t){var a;d.includes(t)||(d.push(t),(a=e.events)==null||a.forEach(s=>{t.addEventListener(s,h,{passive:!0})}))}function X(){d.forEach(t=>{var a;(a=e.events)==null||a.forEach(s=>{t.removeEventListener(s,h)})}),d.length=0}function J(t,a){const s={loading:t.getAttribute(Q)??e.loading,error:t.getAttribute($)??e.error,attempt:t.getAttribute(E)?Number(t.getAttribute(E)):e.attempt};t._lazy={src:a.value,arg:a.arg,currentAttempt:0,state:"pending",attemptLock:!1,...s},m(t,p),R(e.filter,t._lazy)}function tt(t,a){const s=new Image;s.src=a,t._lazy.preloadImage=s,s.addEventListener("load",()=>{t._lazy.attemptLock=!1,w.add(a),I(t,a)}),s.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?H(t):x(t)})}function x(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:a}=t._lazy;if(w.has(a)){I(t,a),t._lazy.attemptLock=!1;return}F(t),tt(t,a)}async function _(t){await W(),T(t)&&x(t)}function u(){l.forEach(t=>_(t))}async function at(t){!l.includes(t)&&l.push(t),O(t).forEach(K),await _(t)}function f(t){S(l,t),l.length===0&&X()}function et(t,a){const{src:s,arg:g}=t._lazy;return s!==a.value||g!==a.arg}async function j(t,a){J(t,a),await at(t)}async function st(t,a){if(!et(t,a)){l.includes(t)&&await _(t);return}await j(t,a)}function nt(t={}){const{events:a,loading:s,error:g,attempt:B,throttleWait:C,filter:U}=t;e.events=a??e.events,e.loading=s??e.loading,e.error=g??e.error,e.attempt=B??e.attempt,e.throttleWait=C??e.throttleWait,e.filter=U}const ot={mounted:j,unmounted:f,updated:st,install(t,a){nt(a),h=k(u,e.throttleWait),t.directive("lazy",this)}},c=ot,rt={basicUsage:"基本使用",backgroundImageLazyLoad:"背景图懒加载"},ct={basicUsage:"Basic Usage",backgroundImageLazyLoad:"Background Image Lazy Load"},{add:N,use:it,pack:b,packs:vt,merge:Lt}=i.useLocale(),lt=t=>{i.use(t),it(t)};i.add("zh-CN",i.zhCN);i.add("en-US",i.enUS);N("zh-CN",rt);N("en-US",ct);const ut={class:"lazy-example-cat"},dt={class:"lazy-example-cat"},mt={class:"lazy-example-cat"},gt={class:"lazy-example-cat"},pt={class:"lazy-example-cat"},ht={class:"lazy-example-cat"},_t={__name:"index",setup(t){return G(lt),(a,s)=>(P(),V(M,null,[A(n(L),null,{default:y(()=>[z(v(n(b).basicUsage),1)]),_:1}),o(r("img",ut,null,512),[[n(c),"https://varletjs.github.io/varlet/cat.jpg"]]),o(r("img",dt,null,512),[[n(c),"https://varletjs.github.io/varlet/cat.jpg"]]),o(r("img",mt,null,512),[[n(c),"https://varletjs.github.io/varlet/cat.jpg"]]),o(r("img",gt,null,512),[[n(c),"https://varletjs.github.io/varlet/cat.jpg"]]),o(r("img",pt,null,512),[[n(c),"https://varletjs.github.io/varlet/cat.jpg"]]),A(n(L),null,{default:y(()=>[z(v(n(b).backgroundImageLazyLoad),1)]),_:1}),o(r("div",ht,null,512),[[n(c),"https://varletjs.github.io/varlet/cat.jpg","background-image"]])],64))}},Et=D(_t,[["__scopeId","data-v-28ee1699"]]);export{Et as default};
